<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.TextFlow?>
<?import javafx.scene.web.WebView?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.shape.Line?>

<AnchorPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.example.dto.gui.NeuroSymbolicController">
    <!-- Primary SplitPane: Cockpit vs Hub -->
    <SplitPane dividerPositions="0.28" AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0">
        
        <!-- Left Panel: Control & Simulation Cockpit -->
        <VBox minWidth="280.0" maxWidth="450.0" spacing="0.0" styleClass="lab-panel">
            <!-- Header Bar -->
            <HBox styleClass="lab-header" alignment="CENTER_LEFT">
                <Label text="COCKPIT CONTROL" styleClass="lab-header-text" />
            </HBox>
            
            <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;">
                <VBox spacing="12.0" style="-fx-padding: 12;">
                    
                    <!-- A. Drug Identity Zone -->
                    <VBox spacing="8" style="-fx-padding: 10; -fx-background-color: white; -fx-border-color: #BDC3C7;">
                        <Label text="DRUG IDENTITY" style="-fx-font-weight: bold; -fx-text-fill: #566573; -fx-font-size: 10px;" />
                        
                        <HBox spacing="4">
                            <TextField fx:id="nsDrugSearchField" promptText="Search SMILES/Name..." HBox.hgrow="ALWAYS" styleClass="text-field" />
                            <Button fx:id="nsAnalyzeButton" onAction="#onAnalyze" text="RUN" styleClass="action-button" />
                        </HBox>
                        
                        <!-- Structure Viewer (WebView) -->
                        <StackPane minHeight="150" style="-fx-background-color: white; -fx-border-color: #EAEDED; -fx-border-width: 1;">
                            <WebView fx:id="nsDrugStructureWebView" prefHeight="150" />
                            <Label fx:id="nsNoStructureLabel" text="WAITING FOR INPUT..." textFill="#BDC3C7" visible="false"/>
                        </StackPane>
                        
                        <!-- Property Chips -->
                        <FlowPane fx:id="nsPropFlowPane" hgap="4" vgap="4">
                            <!-- Chips will be added dynamically: MW, LogP, etc. -->
                        </FlowPane>
                    </VBox>
                    
                    <!-- B. ML Predictor Zone (Risk Spectrum) -->
                    <VBox spacing="8" style="-fx-padding: 10; -fx-background-color: white; -fx-border-color: #BDC3C7;">
                        <Label text="TOXICITY RISK ASSESSMENT" style="-fx-font-weight: bold; -fx-text-fill: #566573; -fx-font-size: 10px;" />
                        
                        <VBox spacing="15" alignment="CENTER">
                            <StackPane fx:id="nsSpectrumContainer">
                                <!-- Spectrum Bar -->
                                <Region fx:id="nsRiskSpectrumBar" styleClass="risk-spectrum" />
                                <!-- Marker -->
                                <Region fx:id="nsRiskMarker" styleClass="risk-marker" StackPane.alignment="CENTER_LEFT">
                                    <StackPane.margin>
                                        <Insets left="0" />
                                    </StackPane.margin>
                                </Region>
                                <!-- Value Label (floating) -->
                                <Label fx:id="nsRiskValueLabel" text="0.00" style="-fx-font-weight: bold; -fx-font-size: 12px; -fx-translate-y: -20;" />
                            </StackPane>
                            
                            <HBox alignment="CENTER_LEFT">
                                <Label text="SAFE (0.0)" style="-fx-font-size: 8px; -fx-text-fill: #7F8C8D;" />
                                <Region HBox.hgrow="ALWAYS" />
                                <Label text="TOXIC (1.0)" style="-fx-font-size: 8px; -fx-text-fill: #7F8C8D;" />
                            </HBox>
                        </VBox>
                        
                        <Separator />
                        
                        <GridPane hgap="10" vgap="4">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="50" />
                                <ColumnConstraints percentWidth="50" />
                            </columnConstraints>
                            <VBox GridPane.columnIndex="0">
                                <Label text="EST. CONFIDENCE" style="-fx-font-size: 8px; -fx-text-fill: #7F8C8D;" />
                                <Label fx:id="nsConfidenceLabel" text="---" style="-fx-font-weight: bold; -fx-font-size: 11px;" />
                            </VBox>
                            <VBox GridPane.columnIndex="1" alignment="TOP_RIGHT">
                                <Label text="ACTIVE MODEL" style="-fx-font-size: 8px; -fx-text-fill: #7F8C8D;" />
                                <Label fx:id="nsModelNameLabel" text="RandomForest v2.1" style="-fx-font-size: 10px;" />
                            </VBox>
                        </GridPane>
                    </VBox>
                    
                    <!-- C. What-If Simulation Zone -->
                    <VBox spacing="8" style="-fx-padding: 10; -fx-background-color: white; -fx-border-color: #BDC3C7;">
                        <Label text="HYPOTHESIS TESTING (SIMULATION)" style="-fx-font-weight: bold; -fx-text-fill: #566573; -fx-font-size: 10px;" />
                        
                        <VBox spacing="6">
                            <Label text="CURRENT TARGET" style="-fx-font-size: 8px; -fx-text-fill: #7F8C8D;" />
                            <Label fx:id="nsCurrentTargetLabel" text="NONE (BASELINE)" style="-fx-font-weight: bold; -fx-text-fill: #27AE60;" />
                        </VBox>
                        
                        <VBox spacing="4">
                            <Label text="SIMULATION TARGET" style="-fx-font-size: 8px; -fx-text-fill: #7F8C8D;" />
                            <ComboBox fx:id="nsTargetSimulatorBox" promptText="Select Enzyme/Target..." maxWidth="Infinity" styleClass="combo-box" />
                        </VBox>
                        
                        <Button fx:id="nsRunSimulationBtn" onAction="#runSimulation" text="SIMULATE OUTCOME" maxWidth="Infinity" styleClass="action-button" />
                    </VBox>
                    
                    <!-- D. Tree Visualization Controls (HF-SDT Features) -->
                    <VBox spacing="8" style="-fx-padding: 10; -fx-background-color: #EBF5FB; -fx-border-color: #3498DB; -fx-border-width: 2;">
                        <Label text="ðŸŒ³ TREE CONTROLS" style="-fx-font-weight: bold; -fx-text-fill: #2874A6; -fx-font-size: 10px;" />
                        
                        <!-- Depth Control Slider -->
                        <VBox spacing="4">
                            <HBox alignment="CENTER_LEFT">
                                <Label text="Visualization Depth" style="-fx-font-size: 9px; -fx-text-fill: #5D6D7E;" />
                                <Region HBox.hgrow="ALWAYS" />
                                <Label fx:id="nsDepthValueLabel" text="5" style="-fx-font-weight: bold; -fx-font-size: 10px; -fx-text-fill: #2874A6;" />
                            </HBox>
                            <Slider fx:id="nsTreeDepthSlider" min="2" max="10" value="5" showTickLabels="true" showTickMarks="true" majorTickUnit="2" minorTickCount="1" blockIncrement="1" />
                            <HBox alignment="CENTER_LEFT">
                                <Label text="Summary" style="-fx-font-size: 7px; -fx-text-fill: #ABB2B9;" />
                                <Region HBox.hgrow="ALWAYS" />
                                <Label text="Full Diagnostic" style="-fx-font-size: 7px; -fx-text-fill: #ABB2B9;" />
                            </HBox>
                        </VBox>
                        
                        <Separator />
                        
                        <!-- Path Highlighter -->
                        <VBox spacing="4">
                            <Label text="Path Highlighter" style="-fx-font-size: 9px; -fx-text-fill: #5D6D7E;" />
                            <ComboBox fx:id="nsPathHighlightCombo" promptText="Select Leaf Node..." maxWidth="Infinity" style="-fx-font-size: 10px;" />
                            <CheckBox fx:id="nsHighlightEnableCheck" text="Enable Path Highlighting" selected="true" style="-fx-font-size: 9px;" />
                        </VBox>
                        
                        <Separator />
                        
                        <!-- Tree Stats Display -->
                        <GridPane hgap="8" vgap="4" style="-fx-background-color: white; -fx-padding: 6; -fx-background-radius: 4;">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="50" />
                                <ColumnConstraints percentWidth="50" />
                            </columnConstraints>
                            <VBox GridPane.columnIndex="0">
                                <Label text="TOTAL NODES" style="-fx-font-size: 7px; -fx-text-fill: #7F8C8D;" />
                                <Label fx:id="nsTotalNodesLabel" text="--" style="-fx-font-weight: bold; -fx-font-size: 11px; -fx-text-fill: #2C3E50;" />
                            </VBox>
                            <VBox GridPane.columnIndex="1" alignment="TOP_RIGHT">
                                <Label text="MAX DEPTH" style="-fx-font-size: 7px; -fx-text-fill: #7F8C8D;" />
                                <Label fx:id="nsMaxDepthLabel" text="--" style="-fx-font-weight: bold; -fx-font-size: 11px; -fx-text-fill: #2C3E50;" />
                            </VBox>
                        </GridPane>
                        
                        <Button fx:id="nsRefreshTreeBtn" onAction="#onRefreshTree" text="ðŸ”„ REFRESH TREE" maxWidth="Infinity" style="-fx-background-color: #3498DB; -fx-text-fill: white; -fx-font-weight: bold;" />
                    </VBox>
                    
                </VBox>
            </ScrollPane>
            
            <HBox style="-fx-padding: 4; -fx-background-color: #D5DBDB;">
                <Label fx:id="nsSystemStatusLabel" text="ANALYZER STATUS: IDLE" style="-fx-font-size: 8px; -fx-font-weight: bold; -fx-text-fill: #566573;" />
            </HBox>
        </VBox>
        
        <!-- Right Panel: Analysis & Visualization Hub -->
        <VBox style="-fx-background-color: white;">
            <SplitPane orientation="VERTICAL" dividerPositions="0.65" VBox.vgrow="ALWAYS">
                <!-- Upper Split: Visualization Tabs -->
                <TabPane tabClosingPolicy="UNAVAILABLE" styleClass="industrial-tabs">
                    <Tab text="SDT LOGIC TREE &amp; DASHBOARD">
                         <SplitPane dividerPositions="0.7">
                            <!-- Left: Tree Visualization -->
                            <VBox style="-fx-background-color: #F8F9F9; -fx-padding: 10;" VBox.vgrow="ALWAYS">
                                 <StackPane VBox.vgrow="ALWAYS" style="-fx-background-color: white; -fx-border-color: #BDC3C7; -fx-effect: innershadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 0);">
                                    <WebView fx:id="nsSdtTreeWebView" minWidth="0" minHeight="0" StackPane.alignment="CENTER" />
                                    <Label fx:id="nsTreePlaceholder" text="VISUALIZATION SCREEN" textFill="#BDC3C7" alignment="CENTER" StackPane.alignment="CENTER" />
                                 </StackPane>
                            </VBox>
                            
                            <!-- Right: Analysis Dashboard -->
                            <VBox spacing="0" style="-fx-background-color: white;">
                                <!-- 1. Feature Importance -->
                                <VBox spacing="5" VBox.vgrow="ALWAYS" style="-fx-padding: 10;">
                                    <Label text="GLOBAL FEATURE IMPORTANCE" style="-fx-font-weight: bold; -fx-font-size: 10px; -fx-text-fill: #2C3E50;" />
                                    <BarChart fx:id="nsFeatureImportanceChart" animated="false" legendVisible="false" verticalGridLinesVisible="false" horizontalGridLinesVisible="false" style="-fx-background-color: transparent;" minHeight="200" prefHeight="300" VBox.vgrow="ALWAYS">
                                        <xAxis>
                                            <NumberAxis label="Importance (%)" />
                                        </xAxis>
                                        <yAxis>
                                            <CategoryAxis />
                                        </yAxis>
                                    </BarChart>
                                </VBox>
                                
                                <Separator />
                                
                                <!-- 2. Safety Checklist -->
                                <VBox spacing="10" VBox.vgrow="ALWAYS" style="-fx-padding: 15; -fx-background-color: #FAFAFA;">
                                    <Label text="SAFETY VALIDATION CHECKLIST" style="-fx-font-weight: bold; -fx-font-size: 10px; -fx-text-fill: #2C3E50;" />
                                    <VBox fx:id="nsSafetyChecklistVBox" spacing="8" />
                                </VBox>
                            </VBox>
                        </SplitPane>
                    </Tab>
                    <Tab text="NARRATIVE INSIGHT">
                        <VBox spacing="5" style="-fx-padding: 10; -fx-background-color: #F8F9F9;">
                            <TextFlow fx:id="nsInsightTextFlow" style="-fx-background-color: white; -fx-border-color: #BDC3C7; -fx-padding: 15; -fx-font-family: 'Consolas';" />
                        </VBox>
                    </Tab>
                </TabPane>
                
                <!-- Lower Split: Data Grid & Logic Tuner -->
                <VBox spacing="0">
                    <HBox style="-fx-background-color: #BFC9CA; -fx-padding: 4 10;">
                        <Label text="DATA STREAM &amp; LOGIC TUNER" style="-fx-font-weight: bold; -fx-font-size: 10px;" />
                    </HBox>
                    <TableView fx:id="nsDataGridTable" VBox.vgrow="ALWAYS" editable="true">
                        <columns>
                            <TableColumn fx:id="nsParamNameCol" text="PARAMETER" prefWidth="150" />
                            <TableColumn fx:id="nsParamValueCol" text="VALUE" prefWidth="100" />
                            <TableColumn fx:id="nsParamSourceCol" text="SOURCE" prefWidth="120" />
                            <TableColumn fx:id="nsParamThresholdCol" text="THRESHOLD (ADJ)" prefWidth="120" />
                            <TableColumn fx:id="nsParamStatusCol" text="IMPACT" prefWidth="100" />
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                        </columnResizePolicy>
                    </TableView>
                </VBox>
            </SplitPane>
        </VBox>
    </SplitPane>
</AnchorPane>